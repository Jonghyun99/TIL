# HTTP 메서드

## HTTP API 설계

### 요구사항

회원 정보관리 API를 만들어라

- 회원 목록 조회
- 회원 조회
- 회원 등록
- 회원 수정
- 회원 삭제

### API URI 설계

- 회원 목록 조회 /read-member-list
- 회원 조회 /read-member-by-id
- 회원 등록 /create-member
- 회원 수정 /update-member
- 회원 삭제 /delete-member

API URI는 리소스 식별이 되어야 함, ****위와 같은 설계는 별로 좋지 않음

리소스의 의미는?

- 회원을 등록하고 수정하고 조회하는 것이 리소스가 아님
- 회원 자체가 리소스이다.

리소스를 어떻게 식별할까?

- 회원을 등록, 수정, 조회하는 것을 모두 배제
- **회원 리소스만 식별하면 된다. → 리소스를 URI에 매핑**

### 다시 설계해보면..

리소스 식별, URI 계층 구조 활용

- 회원 목록 조회 /members
- 회원 조회 /members/{id}
- 회원 등록 /members/{id}
- 회원 수정 /members/{id}
- 회원 삭제 /members/{id}
- 참고 : 계층 구조상 상위를 컬렉션으로 보고 복수단어 사용 권장

이 때 조회, 등록, 수정, 삭제는 같은 URI가 되어 구분할 수 없게된다.

이를 HTTP 메서드를 통해 구분한다.

## HTTP 메서드

### 주요 메서드

- GET : 리소스 조회
- POST : 요청 데이터 처리, 주로 등록에 사용
- PUT : 리소스를 대체, 해당 리소스가 없으면 생성 (덮어쓰기)
- PATCH : 리소스 부분 변경
- DELETE : 리소스 삭제

### 기타 메서드

- HEAD : GET과 동일, 메시지를 제외한 상태줄과 헤더만 반환
- OPTIONS : 대상 리소스에 대한 통신 가능 옵션을 설명 (CORS에 사용)
- CONNECT : 대상 자원으로 식별되는 서버에 대한 터널 설정
- TRACE : 메시지 루프팩 테스트 실행

거의 안쓴다.

### GET

- 리소스 조회
- 서버에 전달하고 싶은 데이터는 uri속 query(쿼리 파라미터, 쿼리 스트링)를 통해서 전달
- 메시지 바디를 사용해서 데이터를 전달할 수 있지만 비 권장 (지원하지 않는 곳이 많음)

```jsx
GET /members/100 HTTP1.1
HOST: localhost:8080
```

클라이언트 요청

<br/>

```jsx
{
	"username": "young",
	"age": 20
}
```

서버에서 조회한 데이터, 해당 데이터로 응답메시지 생성

```jsx
HTTP/1.1 200 OK
Content-Type: application/json
Content-length: 34

{
	"username":"young",
	"age":20
}	
```

응답 데이터 전달

### POST

- 요청 데이터 처리
- **메시지 바디를 통해 서버로 요청 데이터 전달**
- 서버는 요청 데이터를 처리 (메시지 바디를 통해 들어온 데이터를 처리하는 모든 기능을 수행한다.
- 신규 리소스 등록, 프로세스 처리에 사용

메시지 전달

```jsx
POST /members/100 HTTP1.1
Content-Type: application/json

{
	"username": "young",
	"age": 20
}
```

<br/>

서버 신규 리소스 식별자 생성 (/members/100)

```jsx
{
	"username": "young",
	"age": 20
}
```

응답 데이터 생성

```jsx
// HTTP 응답 메시지 예시
HTTP/1.1 201 Created
Content-Type: application/json
Content-Length: 34
Location: /members/100

{
"	username":young
	"age":20
}
```

POST는 다음과 같은 기능에 사용된다.

- HTML 폼 데이터 처리 프로세스에 제공 (회원가입, 주문 등)
- 게시판, 뉴스, 블로그 등 유사한 기사 그룹에 메시지 게시 (게시판 글쓰기, 댓글 달기)
- 서버가 아직 식별하지 않은 새 리소스 생성 (신규 주문 생성)
- 기존 자원의 데이터 추가

이 리소스 URI에 POST 요청이 오면 요청 데이터를 어떻게 처리할지 리소스 마다 정해야 함

1. 새 리소스 생성(등록) - 서버가 아직 식별하지 않은 새 리소스 생성
2. 요청 데이터 처리 - 프로세스 상태가 처리, 변경되는 경우 (리소스가 성성되지 않을 수도 있음)
3. 다른 메서드로 처리하기 애매한 경우

### PUT

- 리소스를 덮어씀 (없으면 생성, 있으면 덮어씀)
- 클라이언트가 리소스를 식별 (리소스 위치를 알고 URI를 지정함)

### PATCH

- 리소스를 부분변경함
- 한 필드만 보내도 객체의 그 필드만 수정할 수 있음
- 지원 안되는 서버가 간혹 있음, POST사용

### DELETE

- 리소스 제거
- 특정 리소스를 지정하고 전송하면 지워짐

## HTTP 메서드 속성

- 안전 : 호출해도 리소스가 변경되지 않는다.
- 멱등 : 한번 호출하든 두번 호출하든 결과가 똑같다. (GET : 몇 번 조회하든 같은 결과 반환 / PUT : 같은 결과를 대체함 / DELETE : 같은걸 삭제함 / POST : 멱등이 아님, 두번 호출될 때 같은 결제가 중복할 수 있음)
- 캐시가능 : 응답 결과 리소스를 캐시해서 사용해도 되는가? (GET, HEAD, POST, PATCH 캐시가능, 실제로는 GET, HEAD 정도만 캐시로 사용)

멱등은 자동 복구 메커니즘에 사용, 서버에 대한 호출을 못받았을 때 멱등으로 재요청 해도 되는지 판단하여 개발함