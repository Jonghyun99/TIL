# HTTP 상태코드

## 상태코드

클라이언트가 보낸 요청의 처리 상태를 응답에서 알려주는 기능

- 1xx (Informational): 요청 수신되어 처리중
- 2xx (Successful): 요청 정상 처리
- 3xx (Redirection): 요청을 완료하려면 추가 행동이 필요
- 4xx (Client Error): 클라이언트 오류, 잘못된 문법등으로 서버가 요청을 수행할 수 없음
- 5xx (Server Error): 서버 오류, 서버가 정상 요청을 처리하지 못함

## 1xx (Informational)

요청이 수신되어 처리중

- 거의 사용하지 않음

## 2xx (Successful)

클라이언트의 요청을 성공적으로 처리

- 200 OK: 요청 성공
- 201 CREATED: 요청 성공하여 새로운 리소 스가 생성됨
- 202 Accepted: 요청 접수되었으나 처리 완료되지 않음 (배치처리, 예시: 요청 접수 1시간 뒤 배치 실행)
- 204 No Content: 요청 수행했으나 응답 본문에 보낼 데이터가 없음 예) 웹 문서 save버튼

## 3xx (리다이렉션)

- 영구 리다이렉션 - 특정 리소스의 URI가 영구적으로 이동
- 일시 리다이렉션 - 일시적인 변경
    - 주문 완료 후 주문 내역 화면으로 이동
    - PRG: POST/Redirect/Get
- 특수 리다이렉션
    - 결과 대신 캐시를 사용

### 영구 리다이렉션

301, 308

- 리소스의 URI가 영구적으로 이동
- 원래의 URL를 사용, 검색 엔진 등에서도 변경 인지
- 301 Moved Permanently
    - 리다이렉트시 요청 메서드가 GET으로 변하고, 본문이 제거될 수 있음(MAY)
- 308 Permanent Redirect
    - 301과 기능은 같음
    - 리다이렉트시 요청 메서드와 본문 유지(처음 POST를 보내면 리다이렉트도

### 일시적 리다이렉션

302, 307, 303

- 리소스 URI가 일시적으로 변경
- 검색 엔진 등에서 URL을 변경하면 안됨
- 302 Found
    - 리다이렉트시 요청 메서드가 GET으로 변하고, 본문이 제거될 수 있음
- 307 Temporary Redirect
    - 302와 기능은 같음
    - 리다이렉트 요청 메서드와 본문 유지(요청 메서드를 변경하면 안된다)
- 303 See Other
    - 302와 기능은 같음
    - 리다이렉트시 요청 메서드가 Get으로 변경

## PRG: POST/Redirect/Get

일시적인 리다이렉션 - 예시

- POST주문 후 웹 브라우저를 새로고침 하면?
- 새로고침은 다시 요청
- 중복 주문이 될 수 있다.

일반적인 POST 요청 상황

1. 주문 POST 요청
2. 주문 데이터 저장
3. 응답 (주문완료페이지)
4. 주문결과 화면에서 새로고침
5. 한번 더 주문 POST요청이 일어남

일반적으로 이런 상황은 서버에서 방지해둔다.

하지만 클라이언트에서도 이런 상황을 방지하기 위한 방법으로 PRG를 사용한다.

PRG사용

1. POST로 주문후 새로고침으로 인한 중복 주문 방지
2. POST로 주문후 주문 결과 화면을 GET 메서드로 리다이렉트
3. 새로고침해도 결과 화면을 GET으로 조회
4. 중복 주문 대신 결과 화면만 GET으로 다시 요청

    URL이 이미 POST → GET으로 리다이렉트 됨, 새로고침 해도 GET으로 결과 화면만 조회

- 정리
    - 302 Found → GET으로 변할 수 있음
    - 307 Temporary Redirect → 메서드가 변하면 안됨
    - 303 See OTher → 메서드가 Get으로 변경
- 역사
    - 처음 302 스펙의 의도는 HTTP 메서드를 유지하는 것
    - 그런데 웹 브라우저들이 대부분 GET으로 바꾸어버림
    - 모호한 302를 대신할 307, 303이 등장함
- 현실
    - 307, 303을 권장하지만 많은 애플리케이션 라이브러리들이 302를 기본값으로 사용
    - 자동 리다이렉션시 GET으로 변해도 되면 그냥 302를 사용해도 큰 문제 없음

## 기타 리다이렉션

300 304

- 300 Multiple Choices : 안씀
- 304 Not Modified
    - 캐시를 목적으로 사용
    - 클라이언트에게 리소스가 수정되지 않았음을 알려준다. 따라서 클라이언트는 로컬PC에 저장된 캐시를 재사용한다. (캐시로 리다이렉트 한다.)
    - 304 응답은 응답에 메시지 바디를 포함하면 안된다. (로컬 캐시를 사용해야 하므로)
    - 조건부 GET, HEAD 요청시 사용

## 4xx - 클라이언트 오류 / 5xx - 서버 오류

### 4xx(Client Error)

- 클라이언트의 요청에 잘못된 문법등으로 서버가 요청을 수행할 수 없음
- 오류의 원인이 클라이언트에 있음
- 클라이언트가 이미 잘못된 요청, 데이터를 보내고 있기 때문에, 똑같은 재시도가 항상 실패함

### 400 Bad Request

클라이언트가 잘못된 요청을 해서 서버가 요청을 처리할 수 없음

- 요청 구문, 메시지 등등 오류
- 클라이언트는 요청 내용을 다시 검토하고, 보내야함
- 예) 요청 파라미터가 잘못되거나, API 스펙이 맞지 않을 때

### 401 Unauthorized

클라이언트가 해당 리소스에 대한 인증이 필요함

- 인증이 되지 않음
- 401 오류 발생시 응답에 WWW_Authenticate 헤더와 함께 인증 방법을 설명
- 참고
    - 인증(Authentication) : 본인이 누구인지 확인
    - 인가(Authorization) : 권한부여, (특정 리소스에 대한 권한 등)
    - 오류 메시지가 Unauthorized 이지만 인증 되지 않음

### 403 Forbidden

서버가 요청을 이해했지만 승인을 거부함

- 인증 자격 증명은 있지만, 접근 권한이 불충분한 경우
- 예) 일반 사용자가 어드민 권한 리소스에 접근했을 때

### 404 Not Found

요청 리소스를 찾을 수 없음

- 요청 리소스가 서버에 없음
- 또는 클라이언트가 권한이 부족한 리소스에 접근할 때 해당 리소스를 숨기고 싶을 때

### 5xx (Server Error)

서버 오류

- 서버 문제로 오류 발생
- 서버 문제가 있기 때문 재시도 하면 성공할 수도 있음(복구가 되거나 등등)

### 500 Internal Server Error

서버 문제로 오류 발생, 애매하면 500 오류

- 서버 내부 문제로 오류 발생
- 애매하면 500 오류

### 503 Service Unavailable

서비스 이용 불가

- 서버가 일시적인 과부하 또는 예정된 작업으로 잠시 요청을 처리할 수 없음
- Ready-After 헤더 필드로 얼마뒤에 복구되는지 보낼 수 있음

백엔드 개발자 입장에서 5XX 에러는 최대한 배제시켜야 한다.

- 주문 시 고객의 잔고가 모자랄 때
- 상품 구매에 필요한 나이보다 적을 때

위와 같은 예외에 대비하여 코드를 작성하지 않다면 5xx에러를 일으킬 수 있지만 실제 비즈니스 로직에 문제가 생긴 상황은 아니기 때문에 5xx에러를 일으키면 안된다. (2xx이나 4xx 응답으로 해결하여야 함)