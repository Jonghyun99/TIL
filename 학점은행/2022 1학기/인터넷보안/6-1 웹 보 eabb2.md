# 6-1. 웹 보안 취약점 개요

## HTTP 요청 메시지

### HTTP 메소드

요청의 의도를 담고 있는 GET, POST, PUT, DELETE 등이 있음

- GET: 존재하는 자원에 대한 요청
- POST: 새로운 자원을 생성
- PUT: 존재하는 자원에 대한 변경
- DELETE: 존재하는 자원에 대한 삭제

Request Target은 HTTP Request가 전송되는 목표 주소

<br/>

### Header

HTTP Request에 대한 정보를 담고 있음

- key: value형태로 이루어져 있음,
- Host: 요청하려는 서버 호스트 이름과 포트 번호
- User-agent: 클라이언트 프로그램의 정보( 이 정보를 통해 브라우저에 맞는 데이터로 보냄)
- Referer: 바로 직전에 머물렀떤 웹 링크 주소
- Accept: 클라이언트가 처리 가능한 미디어 타입 종류 나열
- If-Modified-Since: 여기에 쓰여진 시간 이후로 변경된 리소스 취득, 페이지가 수정 되었으면 최신 페이지로 교체
- Authorization: 인증 토큰을 서버로 보낼 때 쓰이는 Header

<br/>

### GET 메소드의 구성

GET은 어떤 정보를 가져와 조회하기 위해 사용되는 방식

- URL에 변수(데이터)를 포함시켜 요청함
- 데이터를 Header에 포함하여 전송함
- URL에 데이터가 노출되어 보안에 취약함

<br/>

용도

- 홈페이지 로그인 하는 상황에서 ID, PW 입력하여 Enter 클릭 (보안 취약)
- 여러 개의 Key와 Value를 보내는 경우 Get 방식은 최소한의 보안 유지도 하지 않음
- 실제 웹사이트에서 ID,PW를 중요한 정보를 Get방식으로 사용하면 개인정보가 노출됨
- GET 방식을 사용해 데이터를 노출시키는 경우, 개인정보가 포함되지 않는 상황에서 캐싱을 해 속도를 높이거나 즐겨찾기를 편리하게 사용하기 위해 사용되는 경우가 많음
- 어떤 물건 A에 대해 즐겨찾기를 추가하면, 그 물건의 이름이 A라는 정보를 URL에 추가해 즐겨찾기를 생성할 수 있음

<br/>

### POST 메소드의 구성

POST는 데이터를 서버로 제출하여 추가 또는 수정하기 위해 사용하는 방식

- URL에 변수를 노출하지 않음
- 데이터를 BODY에 포함시킴
- URL에 데이터가 노출되지 않아 기본 보안이 되어 있음 → 캐싱할 수 없음
- GET방식은 URL에 데이터를 붙여서 전송하는 반면, POST방식은 Body에 데이터를 넣어 전송함
- 따라서 헤더필드 중 Body의 데이터를 설명하는 Content-Type이라는 헤더 필드가 들어가고 어떠한 데이터 타입인지 명시해야 함
- 데이터를 Body에 포함시키는 이점 때문에 메시지 길이 제한은 없지만 요청 받는 시간인 Time out이 존재하므로 클라이언트에서 페이지를 요청하고 기다리는 시간이 조재함
- 실제 상황에서 POST 방식은 URL에 데이터를 노출되지 않으므로 캐싱이 불가능 하지만 문자열, 라디오버튼, 텍스트 박스 같은 객체들의 값도 전송 가능함

<br/>

### HTTP 요청 장단점

장점

GET 방식

- 속도가 빠름,
- URL 공유 가능함

POST 방식

- 입력 값이 노출되지 않음
- 바이너리 데이터 전송 가능함

<br/>

단점

GET방식

- 입력값이 노출됨
- 데이터 전송 크기 제한 있음
- 바이너리 데이터 전송이 불가능함

POST 방식

- 속도가 느림

<br/>

- Get방식 Post방식은 서로 장단점이 있어 상호 보완적임
- 그렇기에 두 방식 모두 사용됨
- 상황에 따라 적절히 사용
- 예) 홈페이지 내에서 게시판 이동과 회원가입
(게시판 이동은 속도가 중요하고 노출이 상관없으므로 GET 사용)
(회원 가입은 POST 사용)

<br/>

### 메소드 동작 정의

- GET: 서버 자원 전송을 요청
- POST: BODY를 통해 서버로 데잍 ㅓ전송
- HEAD: 헤더만 전송
- OPTIONS: 서버가 지원하는 메소드를 질의
- TRACE: 클라이언트 요청을 반환
- PUT: 클라이언트가 서버의 지정한 URI로 자원을 전송
- DELETE: 서버의 자원을 삭제
- CONNECT: 프록시 터널링을 위해 예약된 메소드

<br/>

## HTTP 응답 메시지

### Status Code(상태코드)

- 3자리 숫자이며 Request에 대한 응답으로 서버에서 생성함
- 100~199 정보전송
- 200~299 성공
- 300~399 리다이렉션
- 400~499 클라이언트 오류
- 500~599 서버오류

<br/>

## HTTP 특징

1. 비 연결 지향 프로토콜
    1. 클라이언트가 요청을 서버에 보내면 서버는 클라이언트에게 요청에 맞는 응답을 보내고 접속을 끊음
    2. 성능상 비효율적: 클라이언트가 요청 보낼 떄 마다 새로 접속 해야 함
    3. 프로토콜 상의 개선,
    1.0: 한 번의 접속으로 여러 개 요청과 응답을 반복 가능, 
    1.1: 특정 시간 동안 접속을 열어 두고 요청을 보낼 수 있도록 함
    4. 요청 헤더의 Keep-alive: 얼마동안 접속을 열어 둘 것인가?
2. HTTP는 상태 정보 유지 안함 프로토콜 (Sateless)
    1. 상태 정보 저장해야 할 경우 쿠키와 세션을 사용한다.
    

<br/>

<br/>

## 하이퍼텍스트 및 URI

### 정적인 콘텐트

- 내용의 변경 없음 → 웹 서버는 파일을 읽어 그대로 전송

<br/>

### 동적인 콘텐츠

- 사용자의 상황에 혹은 요청에 따라 내용이 달라짐
- 서버 사이드 스크립트 언어(JSP, ASP, PHP)
- 웹 서버가 SSL로 작성된 페이지를 내부적으로 실행 (실행 결과 HTML 문서 전송)
- 예) select.jsp라는 웹 페이지를 호출: 입력 파라미터 ID = 100

<br/>

### 클라이언트 사이드 스크립트

- 서버와 클라이언트는 상호 통신을 함
- 브라우저를 켜고 특정 웹 사이트에 접속하려고 하면 클라이언트 요청이 서버로 가고 서버에서 해당 페이지를 응답함
- 서버 사이드 스크립트 프로그램은 스크립트 형태의 프로그램을 뜻 함
- 웹사이트 접속 시 클라이언트에서 해석, 실행되는 프로그램은 클라이언트 사이드 프로그램(해석은 스크립트 언어의 특징이고 실시간의 의미)
- ex) 메일전송기능
    - 메일 쓰기 페이지는 클라이언트 영역
    - 메일 작성, 폼 전송을 누르면 브라우저에서 작성된 내용이 먼저 서버로 전송되고, 서버에서 받은 내용을 메일 서버를 통해 타 메일 서버로 전송함
    - 이 때 서버에서 받은 내용을 DB에 저장할 수 있고, 첨부파일의 경우 파일로 남길 수도 있음

<br/>

### URI(Uniform Resource Identifier)

- 인터넷의 특정 자원에 접근하기 위해 사용하는 식별자
- 정보 리소스를 고유하게 식별하고 위치를 지정할 수 있음
- URL은 리소스가 정확히 어디 있고 어떻게 접근할 수 있는지 분명히 알려줌
- URL은 URI의 하위 집합 (도메인 까지 URL, 그 뒤 주소는 URI)

<br/>

구조

- 스키마 이름: http, https 등 프로토콜
- 자격 정보: 서버에서 자원을 취득하는데 필요한 자격 정보, 생략가능
- 서버의 호스트 이름FQDN, IP 주소
- 서버 포트 번호: 생략시 기본 포트 번호 사용
- 계층적 파일 경로: 요청하는 자원의 경로
- 질의 문자열: 임의 매개변수 전달 위한 목적, 생략 가능
- 단편 식별자: 취득한 자원에서 그 하위 부분을 # 등으로 가리킴

<br/>

## 웹 취약점 및 서버 보안

### 구글 해킹 및 구글 도크

- 구글 검색 엔진으로 구글 검색은 단순한 지식 검색뿐 아니라 해킹 분야에서도 많이 활용됨
- 구글 검색 문법을 통한 해킹: 구글 해킹 또는 구글 도크
- 구글 해킹은 웹 사이트가 사용하는 구성과 컴퓨터 코드에 보안 구멍을 찾기 위해 Google 검색 및 기타 Google 응용 프로그램을 사용하는 컴퓨터 해킹 기술
- 공격자는 개인정보 등 손쉽게 취약점 찾을 수 있음
- 기본적인 검색 연산자를 알아야 함( 몇 가지만 알아도 검색 가능)
- 검색의 기본 형태는 연산자와 문구
- 연산자는 어디에서를, 문구는 무엇을 의미함

- 따옴표(” “): 여러개 단어를 묶어서 검색
- filetype: 특정 파일 타입만 검색
- site: 특정 사이트 내에서만 검색
- intitle, alltitle: 타이틀 키워드 있는 사이트만 검색
- inurl: url 키워드가 존재하는 사이트의 검색결과만 보여줌
- intext: 키워드를 입력하면 본문에 키워드가 존재하는 사이트를 검색해 보여줌

<br/>

### 구글 해킹에 의한 정보 수집

- 타깃의 개인정보 및 개인정보 목록
- 사용자명 및 웹 서버 관리자의 메일 주소 목록
- 취약성을 가진 웹 서버와 웹 앱
- 패스워드를 포함한 파일 및 목록
- 로그인 페이지 관리자용의 인증 페이지
- 인터넷에 접속한 하드웨어(프린터, 라우터, 카메라 등)

<br/>

### 웹 취약점 스캐너

- 비싼 취약점 스캐너와 보안 감사 툴도 있지만 무료 제품, 서비스도 있음
- 특정 취약점만 조사는 제품이나 더 넓은 범위에서 IT 보안을 점검하는 제품들이 있음
- 오픈 VAS, 레티나, MBSA, 넥스포즈 커뮤니티, 시큐어체크, 퀼리스 프리스캔

<br/>

### OWASP

- 비영리 국제 단체로 웹 서버 보안 기관
- 해킹 공격, 보안 취약점, 정보 노출 등 연구함
- 3년주기로 OWASP TOP 10이란 보안 위협 10가지 이슈를 발표함

<br/>

### SQL 인젝션

데이터베이스와 관련된 보안 취약점

- 사용자 입력 값에 유효성을 검증하지 않고 그대로 사용할 때 발생함
- SQL: 주로 웹 애플리케이션이 데이터베이스을 조회할 때 사용하는 언어
이 언어의 문법 허점을 이용해 인터프리터를 속여 원하는 SQL 쿼리문을 실행하도록 공격

<br/>

### 공격유형

1. 에러 기반 공격: 
    1. 해커가검사하지 않은 입력값을 발견하고 이를 악용할 때 발생하는 공격
    2.  검사 입력값은 불필요한 부분을 제거하는데 해커는 잘못된 정보를 입력하고 피드백을 기다리기만 하면 그 정보를 가로챔
2. 블라인드 공격
    1. 에러 기반 공격과 달리 서버 에러 메시지를 이용하지 않고 바로 데이터베이스를 공격, 성공이 어렵지만 꾸준히 발생하는 공격

웹 공격 동향보고서에 따르면 SQL인젝션 공격이 45%엿음 (운송업, 제조, 건설업 비율이 큼)

<br/>

### 방지

- 웹 방화벽 도입이 중요함
- 웹 방화벽은  의심스러운 트래픽 감지, 탐지, SQL인젝션에 대응함

<br/>

## 경로조작

- 검증되지 않은 외부 입력값을 통해 파일 및 서버 등 시스템 자원에 대한 접근 혹은 식별을 허용할 경우, 입력값 조작을 통해 시스템 자원에 임의 접근 가능
- 경로 조작 및 자원 삽입 약점을 이용해 공격자는 자원의 조작, 노출, 서비스 장애를 유발할 수 있음 (허용되지 않은 권한을 획득할 수 있음)

<br/>

### 대책

- 외부의 입력을 자원의 식별자로(파일, 소켓 포트) 사용하는 경우
- 특히 외부 입력이 파일명인 경우 경로순회공격 위험이 있는 문자를 제거할 수 있는 필터를 이용함

<br/>

<br/>

### 위험한 파일 형식 업로드

- 서버측에서 실행할 수 있는 스크립트 파일(ASP,JSP 등)이 업로드 가능하고, 공격자가 웹을 통해 직접 실행시킬 수 있는 경우
- 공격자는 스크립트 파일로 업로드하고 이 파일을 통해 시스템 내부 명령어를 실행하거나 외부와 연결해 시스템을 가로챌 수 있음

<br/>

### 대책

- 화이트리스트 방식의 허용된 확장자만 업로드 허용
- 서버에 파일을 저장할 때 파일 이름과 경로를 임의문자열로 저장
- 파일 저장 경로가 웹 서버 문서 디렉터리 아래가 아닌 다른 곳으로 설정
- 파일이 서버에서 실행될 수 없도록 실행속성 제거